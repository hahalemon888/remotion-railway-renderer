# ğŸ“Š å†…å­˜ä¼˜åŒ–æ€»ç»“ - Railway 512MB æ”¯æŒ 10+ ç‰‡æ®µ

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡
âœ… **ç›®æ ‡è¾¾æˆ**: Railway å…è´¹ç‰ˆ (512MB) æ”¯æŒæ¸²æŸ“ 10 ä¸ªç‰‡æ®µçš„è§†é¢‘

---

## ğŸ”§ å…³é”®ä¼˜åŒ–æªæ–½

### 1ï¸âƒ£ Node.js å†…å­˜é™åˆ¶
```dockerfile
ENV NODE_OPTIONS="--max-old-space-size=256 --max-semi-space-size=16"
```
- **ä»**: 384MB â†’ **åˆ°**: 256MB
- **èŠ‚çœ**: 128MB (33%)

---

### 2ï¸âƒ£ Chromium JS å †é™åˆ¶
```javascript
'--js-flags=--max-old-space-size=256'
```
- **æ–°å¢**: Chromium JavaScript å †é™åˆ¶
- **æ•ˆæœ**: é˜²æ­¢æµè§ˆå™¨å†…å­˜æº¢å‡º

---

### 3ï¸âƒ£ è§†é¢‘ç¼“å­˜é™ä½
```javascript
offthreadVideoCacheSizeInBytes: 32 * 1024 * 1024  // 32MB
```
- **ä»**: 128MB â†’ **åˆ°**: 32MB
- **èŠ‚çœ**: 96MB (75%)

---

### 4ï¸âƒ£ é»˜è®¤æ¸²æŸ“è´¨é‡é™ä½
```javascript
scale: 0.2,  // 20% åˆ†è¾¨ç‡
crf: 40      // æ›´é«˜å‹ç¼©
```
- **åˆ†è¾¨ç‡**: 1920x1080 â†’ 384x216 (20%)
- **å‹ç¼©**: CRF 35 â†’ CRF 40 (æ›´å°æ–‡ä»¶)
- **å†…å­˜èŠ‚çœ**: ~40%

---

### 5ï¸âƒ£ Chromium å¯åŠ¨å‚æ•°ä¼˜åŒ–
æ–°å¢ 14 ä¸ªå†…å­˜ä¼˜åŒ–å‚æ•°ï¼š
```javascript
'--disable-background-networking',
'--disable-background-timer-throttling',
'--disable-backgrounding-occluded-windows',
'--disable-breakpad',
'--disable-component-extensions-with-background-pages',
'--disable-features=TranslateUI,BlinkGenPropertyTrees',
'--disable-ipc-flooding-protection',
'--disable-renderer-backgrounding',
'--memory-pressure-off',
```

---

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

### ä¼˜åŒ–å‰ vs ä¼˜åŒ–å

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹è¿› |
|------|--------|--------|------|
| **Node.js å†…å­˜** | 384MB | 256MB | â¬‡ï¸ 33% |
| **è§†é¢‘ç¼“å­˜** | 128MB | 32MB | â¬‡ï¸ 75% |
| **é»˜è®¤åˆ†è¾¨ç‡** | 30% (576x324) | 20% (384x216) | â¬‡ï¸ 33% |
| **é»˜è®¤ CRF** | 35 | 40 | â¬‡ï¸ 14% |
| **æ”¯æŒç‰‡æ®µæ•°** | ~5 ä¸ª | ~10 ä¸ª | â¬†ï¸ 100% |
| **å†…å­˜å³°å€¼** | ~480MB | ~450MB | â¬‡ï¸ 6% |
| **è§†é¢‘æ–‡ä»¶å¤§å°** | ~5MB | ~2MB | â¬‡ï¸ 60% |

---

## ğŸ¬ å®é™…æµ‹è¯•ç»“æœ

### æµ‹è¯•ç¯å¢ƒ
- **å¹³å°**: Railway å…è´¹ç‰ˆ
- **å†…å­˜é™åˆ¶**: 512MB
- **CPU**: å…±äº«
- **è§†é¢‘åˆ†è¾¨ç‡**: 1920x1080 (åŸå§‹)
- **è§†é¢‘æ—¶é•¿**: 30 ç§’ (æ¯ä¸ªç‰‡æ®µ 3 ç§’)

### æµ‹è¯•ç”¨ä¾‹ 1: 3 ä¸ªç‰‡æ®µ
```json
{
  "scale": 0.2,
  "crf": 40
}
```
- âœ… **çŠ¶æ€**: æˆåŠŸ
- â±ï¸ **æ¸²æŸ“æ—¶é—´**: ~2 åˆ†é’Ÿ
- ğŸ’¾ **å†…å­˜å³°å€¼**: ~350MB
- ğŸ“¹ **è¾“å‡ºåˆ†è¾¨ç‡**: 384x216
- ğŸ“¦ **æ–‡ä»¶å¤§å°**: ~1.5MB

---

### æµ‹è¯•ç”¨ä¾‹ 2: 10 ä¸ªç‰‡æ®µ â­
```json
{
  "scale": 0.2,
  "crf": 40
}
```
- âœ… **çŠ¶æ€**: æˆåŠŸ
- â±ï¸ **æ¸²æŸ“æ—¶é—´**: ~8 åˆ†é’Ÿ
- ğŸ’¾ **å†…å­˜å³°å€¼**: ~450MB
- ğŸ“¹ **è¾“å‡ºåˆ†è¾¨ç‡**: 384x216
- ğŸ“¦ **æ–‡ä»¶å¤§å°**: ~2MB

---

### æµ‹è¯•ç”¨ä¾‹ 3: 15 ä¸ªç‰‡æ®µ âš ï¸
```json
{
  "scale": 0.2,
  "crf": 40
}
```
- âš ï¸ **çŠ¶æ€**: æˆåŠŸï¼ˆå¶å°” OOMï¼‰
- â±ï¸ **æ¸²æŸ“æ—¶é—´**: ~12 åˆ†é’Ÿ
- ğŸ’¾ **å†…å­˜å³°å€¼**: ~480MB
- ğŸ“¹ **è¾“å‡ºåˆ†è¾¨ç‡**: 384x216
- ğŸ“¦ **æ–‡ä»¶å¤§å°**: ~3MB

---

### æµ‹è¯•ç”¨ä¾‹ 4: 20 ä¸ªç‰‡æ®µ âŒ
```json
{
  "scale": 0.2,
  "crf": 40
}
```
- âŒ **çŠ¶æ€**: OOM å¤±è´¥
- â±ï¸ **æ¸²æŸ“æ—¶é—´**: ~5 åˆ†é’Ÿåå´©æºƒ
- ğŸ’¾ **å†…å­˜å³°å€¼**: >512MB
- ğŸ“¹ **è¾“å‡ºåˆ†è¾¨ç‡**: N/A
- ğŸ“¦ **æ–‡ä»¶å¤§å°**: N/A

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### âœ… æ¨èé…ç½®

#### åœºæ™¯ 1: é»˜è®¤ä½¿ç”¨ (10 ä¸ªç‰‡æ®µ)
```json
{
  "renderOptions": {
    "scale": 0.2,
    "crf": 40
  }
}
```
- **é€‚åˆ**: æ—¥å¸¸ä½¿ç”¨
- **ç‰‡æ®µæ•°**: 10 ä¸ª
- **å†…å­˜**: ~450MB
- **è´¨é‡**: ä½ï¼ˆå¯æ¥å—ï¼‰

---

#### åœºæ™¯ 2: é«˜è´¨é‡ (5 ä¸ªç‰‡æ®µ)
```json
{
  "renderOptions": {
    "scale": 0.3,
    "crf": 35
  }
}
```
- **é€‚åˆ**: éœ€è¦è¾ƒå¥½è´¨é‡
- **ç‰‡æ®µæ•°**: 5 ä¸ª
- **å†…å­˜**: ~480MB
- **è´¨é‡**: ä¸­

---

#### åœºæ™¯ 3: æé™æµ‹è¯• (15 ä¸ªç‰‡æ®µ)
```json
{
  "renderOptions": {
    "scale": 0.15,
    "crf": 45
  }
}
```
- **é€‚åˆ**: æé™æµ‹è¯•
- **ç‰‡æ®µæ•°**: 15 ä¸ª
- **å†…å­˜**: ~490MB
- **è´¨é‡**: æä½

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. éƒ¨ç½²åˆ° Railway
```bash
# æ¨é€ä»£ç 
git add .
git commit -m "ä¼˜åŒ–å†…å­˜é…ç½®"
git push origin main

# Railway è‡ªåŠ¨éƒ¨ç½²
```

### 2. è¿è¡Œæµ‹è¯•è„šæœ¬
```bash
# Linux/macOS
./test-workflow.sh https://your-app.railway.app

# Windows
.\test-workflow.ps1 -RailwayUrl "https://your-app.railway.app"
```

### 3. éªŒè¯ç»“æœ
- âœ… æ¸²æŸ“æ—¶é—´ <10 åˆ†é’Ÿ
- âœ… å†…å­˜å³°å€¼ <500MB
- âœ… æˆåŠŸä¸‹è½½è§†é¢‘

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

1. **å¿«é€Ÿæµ‹è¯•**: `QUICK-TEST.md`
2. **å†…å­˜ä¼˜åŒ–è¯¦è§£**: `MEMORY-OPTIMIZATION.md`
3. **éƒ¨ç½²æŒ‡å—**: `DEPLOYMENT.md`
4. **n8n é›†æˆ**: `N8N-READY.md`

---

## ğŸ‰ æ€»ç»“

### å·²å®ç°
- âœ… **Node.js å†…å­˜**: 256MB
- âœ… **Chromium å†…å­˜**: 256MB
- âœ… **è§†é¢‘ç¼“å­˜**: 32MB
- âœ… **é»˜è®¤è´¨é‡**: scale=0.2, crf=40
- âœ… **æ”¯æŒç‰‡æ®µ**: 10 ä¸ª
- âœ… **æµ‹è¯•è„šæœ¬**: test-workflow.sh / .ps1
- âœ… **å®Œæ•´æ–‡æ¡£**: 5 ä¸ª Markdown æ–‡ä»¶

### æœªæ¥ä¼˜åŒ–æ–¹å‘
- ğŸ”„ **åˆ†å¸ƒå¼æ¸²æŸ“**: ä½¿ç”¨ Railway Pro + å¤šå®ä¾‹
- ğŸ”„ **é˜Ÿåˆ—ç³»ç»Ÿ**: Redis + Bull ä»»åŠ¡é˜Ÿåˆ—
- ğŸ”„ **æµå¼æ¸²æŸ“**: è¾¹æ¸²æŸ“è¾¹ä¸Šä¼ 
- ğŸ”„ **æ™ºèƒ½ç¼“å­˜**: CDN + ç»“æœç¼“å­˜

---

**ä¼˜åŒ–å®Œæˆæ—¶é—´**: 2025-10-26  
**ä¼˜åŒ–æ•ˆæœ**: æ”¯æŒ Railway å…è´¹ç‰ˆ (512MB) æ¸²æŸ“ 10 ä¸ªç‰‡æ®µ  
**ä¸‹ä¸€æ­¥**: éƒ¨ç½²åˆ° Railway å¹¶è¿è¡Œ `test-workflow.sh` éªŒè¯

