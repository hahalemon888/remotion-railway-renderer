# ğŸ”§ è¶…æ—¶é—®é¢˜ä¿®å¤è¯´æ˜

## é—®é¢˜æè¿°

### ç—‡çŠ¶
```
Timeout (30000ms) exceeded rendering the component initially.
```

### åŸå› 
1. **å•ç‰‡æ®µæ¸²æŸ“æˆåŠŸ** âœ…
2. **ä¸‰ç‰‡æ®µæ¸²æŸ“å¤±è´¥** âŒ

**æ ¹æœ¬åŸå› **ï¼š
- ç«å±±å¼•æ“çš„è§†é¢‘ URL åŠ è½½é€Ÿåº¦æ…¢
- Railway æœåŠ¡å™¨è®¿é—®ä¸­å›½ CDN æœ‰å»¶è¿Ÿ
- å¤šä¸ªç‰‡æ®µéœ€è¦åŠ è½½å¤šä¸ªè§†é¢‘ï¼Œç´¯ç§¯è¶…æ—¶

---

## è§£å†³æ–¹æ¡ˆ

### ä¿®å¤ 1: ç»„ä»¶çº§è¶…æ—¶ï¼ˆ`src/ComplexVideo.tsx`ï¼‰

ä¸ºæ‰€æœ‰åª’ä½“ç»„ä»¶æ·»åŠ  `delayRenderTimeoutInMilliseconds`ï¼š

```typescript
// è§†é¢‘
<OffthreadVideo
  src={segment.backgroundImages[0]}
  delayRenderTimeoutInMilliseconds={120000}  // 120ç§’
  muted
/>

// å›¾ç‰‡
<Img
  src={segment.backgroundImages[0]}
  delayRenderTimeoutInMilliseconds={120000}  // 120ç§’
/>

// éŸ³é¢‘
<Audio 
  src={segment.speaker_audio[0]}
  delayRenderTimeoutInMilliseconds={120000}  // 120ç§’
/>
```

### ä¿®å¤ 2: æ¸²æŸ“çº§è¶…æ—¶ï¼ˆ`server/index.js`ï¼‰

åœ¨ `renderMedia()` é…ç½®ä¸­æ·»åŠ å…¨å±€è¶…æ—¶ï¼š

```javascript
await renderMedia({
  composition,
  serveUrl: bundleLocation,
  codec: 'h264',
  outputLocation: outputPath,
  inputProps,
  
  // âœ¨ å…³é”®ä¿®å¤ï¼šå…¨å±€è¶…æ—¶è®¾ç½®
  timeoutInMilliseconds: 120000,  // 120ç§’
  
  chromiumOptions: { ... },
  // ... å…¶ä»–é…ç½®
});
```

---

## è¶…æ—¶æ—¶é—´å¯¹æ¯”

| å±‚çº§ | ä¿®æ”¹å‰ | ä¿®æ”¹å | è¯´æ˜ |
|------|--------|--------|------|
| **ç»„ä»¶çº§** | 28ç§’ | **120ç§’** | å•ä¸ªåª’ä½“èµ„æºåŠ è½½è¶…æ—¶ |
| **æ¸²æŸ“çº§** | 30ç§’ | **120ç§’** | æ•´ä½“åˆå§‹åŒ–è¶…æ—¶ |

---

## ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªè¶…æ—¶è®¾ç½®ï¼Ÿ

### 1. `delayRenderTimeoutInMilliseconds`ï¼ˆç»„ä»¶çº§ï¼‰
- **ä½œç”¨**ï¼šæ§åˆ¶å•ä¸ªåª’ä½“èµ„æºçš„åŠ è½½è¶…æ—¶
- **ä½ç½®**ï¼š`<OffthreadVideo>`, `<Img>`, `<Audio>` ç»„ä»¶
- **åœºæ™¯**ï¼šåŠ è½½å•ä¸ªè§†é¢‘/å›¾ç‰‡/éŸ³é¢‘æ–‡ä»¶

### 2. `timeoutInMilliseconds`ï¼ˆæ¸²æŸ“çº§ï¼‰
- **ä½œç”¨**ï¼šæ§åˆ¶æ•´ä¸ªç»„ä»¶åˆå§‹åŒ–çš„è¶…æ—¶
- **ä½ç½®**ï¼š`renderMedia()` å‡½æ•°é…ç½®
- **åœºæ™¯**ï¼šå¤šä¸ªç‰‡æ®µåŒæ—¶åŠ è½½æ—¶çš„æ€»è¶…æ—¶

---

## æµ‹è¯•åœºæ™¯

### âœ… åœºæ™¯ 1: å•ç‰‡æ®µæ¸²æŸ“
```json
{
  "segments": [
    { "backgroundImages": ["video1.mp4"] }
  ]
}
```
- **ç»“æœ**ï¼šæˆåŠŸ âœ…
- **åŸå› **ï¼šåªéœ€åŠ è½½ 1 ä¸ªè§†é¢‘

### âŒ åœºæ™¯ 2: ä¸‰ç‰‡æ®µæ¸²æŸ“ï¼ˆä¿®å¤å‰ï¼‰
```json
{
  "segments": [
    { "backgroundImages": ["video1.mp4"] },
    { "backgroundImages": ["video2.mp4"] },
    { "backgroundImages": ["video3.mp4"] }
  ]
}
```
- **ç»“æœ**ï¼šå¤±è´¥ âŒ
- **åŸå› **ï¼šéœ€è¦åŠ è½½ 3 ä¸ªè§†é¢‘ï¼Œè¶…è¿‡ 30 ç§’

### âœ… åœºæ™¯ 3: ä¸‰ç‰‡æ®µæ¸²æŸ“ï¼ˆä¿®å¤åï¼‰
```json
{
  "segments": [
    { "backgroundImages": ["video1.mp4"] },
    { "backgroundImages": ["video2.mp4"] },
    { "backgroundImages": ["video3.mp4"] }
  ]
}
```
- **ç»“æœ**ï¼šæˆåŠŸ âœ…
- **åŸå› **ï¼š120 ç§’è¶³å¤ŸåŠ è½½æ‰€æœ‰è§†é¢‘

---

## éƒ¨ç½²çŠ¶æ€

### Git æäº¤
```bash
commit 650180b
fix: add timeoutInMilliseconds to renderMedia for slow network resources

commit 1ca86b1
fix: increase media loading timeout to 120s for slow networks
```

### Railway éƒ¨ç½²
- **çŠ¶æ€**ï¼šæ­£åœ¨éƒ¨ç½² ğŸš€
- **é¢„è®¡æ—¶é—´**ï¼š3-5 åˆ†é’Ÿ
- **URL**ï¼šhttps://remotion-railway-renderer-production.up.railway.app

---

## æµ‹è¯•æ­¥éª¤

### 1. ç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆ3-5 åˆ†é’Ÿï¼‰

### 2. åœ¨ n8n ä¸­é‡æ–°æµ‹è¯•
ä½¿ç”¨ç›¸åŒçš„ä¸‰ç‰‡æ®µæ•°æ®ï¼š

```json
{
  "compositionId": "ComplexVideo",
  "inputProps": {
    "segments": [
      { "backgroundImages": ["video1.mp4"], ... },
      { "backgroundImages": ["video2.mp4"], ... },
      { "backgroundImages": ["video3.mp4"], ... }
    ]
  },
  "outputFileName": "test-3-segments.mp4",
  "renderOptions": {
    "scale": 0.5,
    "crf": 30
  }
}
```

### 3. é¢„æœŸç»“æœ
```json
{
  "status": "completed",
  "data": {
    "url": "https://your-render.mp4",
    "width": 540,
    "height": 960,
    "duration": "XX.XX"
  }
}
```

---

## è¿›ä¸€æ­¥ä¼˜åŒ–å»ºè®®

### å¦‚æœ 120 ç§’è¿˜ä¸å¤Ÿ

#### æ–¹æ¡ˆ A: å¢åŠ åˆ° 300 ç§’ï¼ˆ5 åˆ†é’Ÿï¼‰
```typescript
delayRenderTimeoutInMilliseconds={300000}
timeoutInMilliseconds: 300000
```

#### æ–¹æ¡ˆ B: é¢„ä¸‹è½½è§†é¢‘
åœ¨ n8n ä¸­å…ˆä¸‹è½½è§†é¢‘åˆ°æœ¬åœ°ï¼š
```javascript
// n8n HTTP Request èŠ‚ç‚¹
GET https://volcano-video-url.mp4
Save to File: /tmp/video.mp4

// ç„¶åä¼ é€’æœ¬åœ°è·¯å¾„
{
  "backgroundImages": ["/tmp/video.mp4"]
}
```

#### æ–¹æ¡ˆ C: ä½¿ç”¨æ›´å¿«çš„ CDN
å°†è§†é¢‘ä¸Šä¼ åˆ°ï¼š
- Cloudflare R2
- AWS S3
- é˜¿é‡Œäº‘ OSSï¼ˆé¦™æ¸¯èŠ‚ç‚¹ï¼‰

---

## æ€§èƒ½å¯¹æ¯”

| ç‰‡æ®µæ•° | è§†é¢‘æ•°é‡ | é¢„è®¡åŠ è½½æ—¶é—´ | 120ç§’å¤Ÿå—ï¼Ÿ |
|--------|----------|--------------|-------------|
| 1 | 1 | ~10-20ç§’ | âœ… å¤Ÿ |
| 3 | 3 | ~30-60ç§’ | âœ… å¤Ÿ |
| 5 | 5 | ~50-100ç§’ | âš ï¸ è¾¹ç¼˜ |
| 10 | 10 | ~100-200ç§’ | âŒ ä¸å¤Ÿ |

**å»ºè®®**ï¼š
- **1-5 ç‰‡æ®µ**ï¼šä½¿ç”¨ 120 ç§’è¶…æ—¶ âœ…
- **5-10 ç‰‡æ®µ**ï¼šä½¿ç”¨ 300 ç§’è¶…æ—¶ âš ï¸
- **10+ ç‰‡æ®µ**ï¼šè€ƒè™‘é¢„ä¸‹è½½æˆ–ä½¿ç”¨æ›´å¿«çš„ CDN ğŸš€

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: ä»ç„¶è¶…æ—¶
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å¢åŠ è¶…æ—¶åˆ° 300 ç§’
2. æ£€æŸ¥è§†é¢‘ URL æ˜¯å¦å¯è®¿é—®
3. ä½¿ç”¨ `curl` æµ‹è¯•ä¸‹è½½é€Ÿåº¦ï¼š
   ```bash
   time curl -o test.mp4 "https://volcano-video-url.mp4"
   ```

### é—®é¢˜ 2: æ¸²æŸ“æ—¶é—´å¤ªé•¿
**åŸå› **ï¼šç­‰å¾…è§†é¢‘åŠ è½½

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨æ›´å¿«çš„ CDN
- é¢„ä¸‹è½½è§†é¢‘åˆ°æœåŠ¡å™¨
- ä½¿ç”¨æ›´å°çš„è§†é¢‘æ–‡ä»¶

### é—®é¢˜ 3: å†…å­˜ä¸è¶³
**ç—‡çŠ¶**ï¼šSIGKILL æˆ– OOM é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
- é™ä½ `scale` åˆ° 0.3-0.4
- æé«˜ `crf` åˆ° 32-35
- å‡å°‘å¹¶å‘ç‰‡æ®µæ•°é‡

---

## æ€»ç»“

### âœ… ä¿®å¤å†…å®¹
1. ç»„ä»¶çº§è¶…æ—¶ï¼š28ç§’ â†’ 120ç§’
2. æ¸²æŸ“çº§è¶…æ—¶ï¼š30ç§’ â†’ 120ç§’

### ğŸ¯ é€‚ç”¨åœºæ™¯
- 1-5 ä¸ªç‰‡æ®µçš„è§†é¢‘æ¸²æŸ“
- ç«å±±å¼•æ“ç­‰æ…¢é€Ÿ CDN
- Railway ç­‰æµ·å¤–æœåŠ¡å™¨

### ğŸš€ ä¸‹ä¸€æ­¥
- ç­‰å¾…éƒ¨ç½²å®Œæˆ
- æµ‹è¯•ä¸‰ç‰‡æ®µæ¸²æŸ“
- å¦‚éœ€æ›´å¤šç‰‡æ®µï¼Œè€ƒè™‘è¿›ä¸€æ­¥ä¼˜åŒ–

---

**ä¿®å¤å®Œæˆæ—¶é—´**ï¼š2025-10-25  
**éƒ¨ç½²çŠ¶æ€**ï¼šå·²æ¨é€åˆ° Railway ğŸš€  
**æµ‹è¯•å»ºè®®**ï¼šç­‰å¾… 3-5 åˆ†é’Ÿåé‡æ–°æµ‹è¯•

